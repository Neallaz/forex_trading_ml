# docker-compose.yml
# version: '3.8'

services:
  # ml-trader:
  #   build: .
  #   container_name: forex-ml-trader-312
  #   # restart: unless-stopped
  #   volumes:
  #     - ./data:/app/data
  #     - ./models:/app/models
  #     - ./logs:/app/logs
  #     - ./results:/app/results
  #   environment:
  #     - PYTHONPATH=/app
  #     - TZ=UTC
  #     - LOG_LEVEL=INFO
  #     - PYTHON_VERSION=3.12
  #   env_file:
  #     - .env
  #   command: python main.py --mode train
  ml-trader:
    build: .
    container_name: ml-trader-dev
    stdin_open: true
    tty: true
    volumes:
      # - ./app:/app
      - ./data:/app/data
      - ./models:/app/models
      - ./logs:/app/logs
      - ./results:/app/results
      - ./config:/app/config
    env_file:
      - .env
    environment:
      - PYTHONPATH=/app
      - LOG_LEVEL=DEBUG
    command: tail -f /dev/null

  dashboard:
    build: .
    container_name: forex-dashboard-312
    restart: unless-stopped
    ports:
      - "8501:8501"
    volumes:
      - ./data:/app/data
      - ./models:/app/models
      - ./dashboard:/app/dashboard
      - ./utils:/app/utils
      - ./config:/app/config
    environment:
      - PYTHONPATH=/app
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      - PYTHON_VERSION=3.12
    env_file:
      - .env
    depends_on:
      - ml-trader
    command: streamlit run dashboard/app.py --server.port=8501 --server.address=0.0.0.0

  db:
    image: postgres:16
    container_name: forex-db-312
    restart: unless-stopped
    environment:
      POSTGRES_DB: forextrading
      POSTGRES_USER: trader
      POSTGRES_PASSWORD: ${DB_PASSWORD:-trading123}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7.2-alpine
    container_name: forex-redis-312
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:

networks:
  default:
    name: forex-network-312